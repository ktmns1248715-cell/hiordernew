<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>하이오더 실시간 견적 사이트 (라이브 업데이트 + 이메일 발송)</title>
<style>
  :root{ --bg:#fff; --card:#fff; --muted:#667085; --text:#0b0f19; --accent:#2563eb; --bd:#e5e7eb; --danger:#b91c1c; }

  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR;
    font-size: clamp(13px, 1.6vw, 16px);
    line-height:1.5;
  }
  .container{ width:100%; max-width:1200px; margin:0 auto; padding:14px; }

  .hero{text-align:center;margin:4px 0 10px}
  .hero h1{font-size:clamp(20px, 3.2vw, 28px);margin:0;color:var(--accent);font-weight:800}
  .hero .sub{margin:6px 0 0;color:#667085;font-size:clamp(12px, 1.4vw, 14px)}
  .hero .team{margin-top:4px;color:#374151;font-size:clamp(12px, 1.4vw, 14px);font-weight:600}

  .card{background:var(--card); border:1px solid var(--bd); border-radius:14px; padding:12px; margin-top:12px; width:100%}
  .card h3{margin:0 0 8px; font-size:clamp(16px, 2.2vw, 20px); display:flex; justify-content:space-between; align-items:center}
  .badge{border:1px solid #c7d2fe;background:#eef2ff;color:#1f2937;border-radius:999px;padding:4px 8px;font-size:clamp(11px, 1.6vw, 12px)}

  .row{display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px dashed var(--bd)}
  .row:last-child{border-bottom:0}
  label{min-width:auto;flex:1}
  input[type=number],textarea{
    background:#fff;border:1px solid #d1d5db;border-radius:10px;color:var(--text);
    padding:10px 12px;font-size:clamp(14px, 1.8vw, 15px);width:100%
  }
  input[type=number]{max-width:140px}
  textarea{width:100%;min-height:90px}
  .muted{color:#6b7280;font-size:clamp(11px, 1.5vw, 12px)}

  .grid-checks{display:grid;grid-template-columns:1fr;gap:8px}
  .check-item{display:flex;align-items:center;justify-content:space-between;gap:6px}
  .check-item input[type=number]{width:70px}

  .btn{border:none;border-radius:10px;padding:12px 10px;font-weight:700;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;line-height:1.2;font-size:13px}
  .btn.blue{background:var(--accent);color:#fff}
  .btn.kakao{background:#FEE500;color:#111}
  .btn.green{background:#166534;color:#fff}
  .btn.secondary{background:#fff;border:1px solid var(--bd);color:#0b0f19}
  a.btn{text-decoration:none}
  .btnRow{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .top-actions{display:flex;justify-content:flex-end;gap:8px}

  .table-wrap{width:100%;overflow-x:auto}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border-bottom:1px solid var(--bd);padding:9px 6px;text-align:right;font-size:clamp(12px, 1.6vw, 13px)}
  th:first-child,td:first-child{text-align:left}
  tfoot td{font-weight:800}
  #tdMonthly,#tdMonthlyLabel{color:var(--accent);font-weight:900;font-size:clamp(14px, 2vw, 16px)}

  .danger{color:var(--danger);font-weight:800}
  .two-col{display:grid;grid-template-columns:1fr;gap:10px}

  @media (min-width:480px){ .grid-checks{grid-template-columns: repeat(2,1fr);} }
  @media (min-width:768px){
    .two-col{grid-template-columns:1fr 1fr}
    .grid-checks{grid-template-columns: repeat(3,1fr);}
  }
  @media (min-width:1024px){ .container{max-width:960px} }
  @media (min-width:1280px){ .container{max-width:1200px} }
</style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <h1>하이오더 실시간 견적 사이트</h1>
      <p class="sub">모바일 최적화 · 수량 입력 즉시 합계 갱신</p>
      <p class="sub">· 초기 설치비 면제(할인) 자동 반영</p>
      <p class="team">
        <span style="color:#4c00ff">KT 동부소상공인 영업팀 대구프론티어센터</span><br>
        <span style="color:#000000"><b>견적서 관리 : 김영훈 과장 010-8290-9971</b></span>
      </p>
    </div>

    <div class="top-actions">
      <button class="btn secondary" id="btnReset">견적 초기화</button>
    </div>

    <!-- 1) 결제 유형 -->
    <div class="card">
      <h3><span style="color:#17ab21"><b>결제 유형</b></span></h3>
      <div class="row"><label><input type="radio" name="paytype" value="후불" checked> 후불형</label></div>
      <div class="row">
        <label><input type="radio" name="paytype" value="선불"> 선불형</label>
        <p class="muted" style="margin:4px 0 0 20px">(+월 2,000원 / 일시불 +67,600원)</p>
      </div>
    </div>

    <!-- 2) 메뉴판 -->
    <div class="card" id="cardMenu">
      <h3>
        <div style="display:flex; flex-direction:column;">
          <span><span style="color:#17ab21"><b>메뉴판</b></span></span>
          <span class="badge">메뉴판 서비스이용료 <span id="badgeMenuSvcCnt">0</span>대 (월 15,000원/대)</span>
        </div>
      </h3>
      <div class="row">
        <label>
          <div>하이오더 1</div>
          <div class="muted">(3년 약정 기준 월 3,000원 <br>/ 일시불 108,000원)</div>
        </label>
        <input id="q_h1" class="qty" type="number" min="0" value="0">
      </div>
      <div class="row">
        <label>
          <div>하이오더 2</div>
          <div class="muted">(3년 약정 기준 월 5,000원 <br>/ 일시불 170,000원)</div>
        </label>
        <input id="q_h2" class="qty" type="number" min="0" value="0">
      </div>

      <h4 class="muted" style="margin:8px 0 4px"><b>메뉴판 거치대</b></h4>
      <div class="grid-checks" id="menuMounts">
        <label class="check-item"><span>스탠드형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>스탠드고정형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>탁상형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>탁상형2</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>벽걸이고정형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>벽걸이회전형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>아일랜드</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
      </div>
      <p class="muted">※ 1개 체크 시 메뉴판 총 수량 전량자동입력, 2개 이상 체크 시 자동 균등배분 후 자유롭게 ± 조정 (합계 유지)</p>
    </div>

    <!-- 3) 알림판 -->
    <div class="card" id="cardSign">
      <h3>
        <div style="display:flex; flex-direction:column;">
          <span><span style="color:#18aa22"><b>알림판</b></span></span>
          <span class="badge">알림판 서비스이용료 <span id="badgeSignSvcCnt">0</span>대 (월 15,000원/대)</span>
        </div>
      </h3>
      <div class="row"><label><div>10인치(하이오더1)</div><div class="muted">(3년 약정 기준 월 3,000원 <br>/ 일시불 108,000원)</div></label><input id="q_s10_h1" class="qty" type="number" min="0" value="0"></div>
      <div class="row"><label><div>10인치(하이오더2)</div><div class="muted">(3년 약정 기준 월 5,000원 <br>/ 일시불 170,000원)</div></label><input id="q_s10_h2" class="qty" type="number" min="0" value="0"></div>
      <div class="row"><label><div>15인치 알림판</div><div class="muted">(3년 약정 기준 월 7,000원 <br>/ 일시불 237,000원)</div></label><input id="q_s15" class="qty" type="number" min="0" value="0"></div>

      <h4 class="muted" style="margin:8px 0 4px"><b>알림판 거치대</b></h4>
      <div class="grid-checks" id="signMounts">
        <label class="check-item"><span>스탠드형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>스탠드고정형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>탁상형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>탁상형2</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>벽걸이고정형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>벽걸이회전형</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
        <label class="check-item"><span>아일랜드</span><span><input type="checkbox" class="mount-check"><input type="number" min="0" value="0" class="mount-qty"></span></label>
      </div>
      <p class="muted" style="text-align:center">※ 1개 체크 시 알림판 총 수량 전량자동입력,<br>2개 이상 체크 시 자동 균등배분 후 <br>자유롭게 ± 조정 (합계 유지)</p>
    </div>

    <!-- 4) 부자재 및 설치비 (할인 대상) -->
    <div class="card">
      <h3><span style="color:#19ae23"><b>부자재 및 설치비</b></span></h3>
      <div class="row"><label>설치비용 <br><span class="muted">(260,000원/건)</span></label><input id="q_install" type="number" readonly value="0"></div>
      <div class="row"><label>상시전원 <br><span class="muted">(48,500원/대)</span></label><input id="q_batt_main" type="number" min="0" value="0"></div>
      <div class="row"><label>보조배터리 <br><span class="muted">(48,500원/대)</span></label><input id="q_batt_portable" type="number" min="0" value="0"></div>
      <div class="row"><label>부자재 <br><span class="muted">(17,000원/대)</span></label><input id="q_parts" type="number" readonly value="0"></div>
      <div class="row"><label>와이파이 AP<br><span class="muted">(100,000원)</span></label><input id="q_ap" type="number" value="1" readonly></div>
      <div class="row"><label>증폭기<br><span class="muted">(97,000원)</span></label><input id="q_amp" type="number" value="1" readonly></div>
      <p class="muted" style="text-align:center"><br>※ 위 5개 품목은 <b>초기 설치비 면제(할인)</b> 대상이며 요약표 합계는 0원으로 표시됩니다. <br>할인 금액은 ‘할인 금액 합계’에 반영됩니다.</p>
    </div>

    <!-- 5) 견적 요약 -->
    <div class="card">
      <h3><span style="color:#18b423"><b>견적 요약</b></span></h3>
      <div class="table-wrap">
        <table class="summary-table">
          <thead>
            <tr><th>품목</th><th>단가</th><th>수량</th><th>공급가</th><th>세액</th><th>합계(VAT포함)</th></tr>
          </thead>
          <tbody id="tbodyLines">
            <tr><td colspan="6" style="text-align:center;color:#6b7280">수량을 입력하면 자동으로 계산됩니다.</td></tr>
          </tbody>
          <tfoot>
            <tr><td id="tdMonthlyLabel">월이용료합계<br>VAT포함</td><td colspan="4"></td><td id="tdMonthly">0</td></tr>
            <tr><td>일시불<br>합계</td><td colspan="4"></td><td id="tdOnetime">0</td></tr>
            <tr><td>할인금액<br>합계</td><td colspan="4"></td><td id="tdDiscount">- 0</td></tr>
            <tr><td>총 합계<br>월일시불-할인</td><td colspan="4"></td><td id="tdGrand">0</td></tr>
          </tfoot>
        </table>
      </div>
    </div>

   
      <div class="btnRow" style="margin-top:10px">
        <a class="btn blue" href="https://tally.so/r/mKAP1k" target="_blank">견적서<br>신청하고<br>혜택상담</button>
        <a class="btn kakao" href="http://pf.kakao.com/_xaXbrn" target="_blank">카카오채널 <br>추가하고<br>실시간채팅<br>상담받기</a>
        <a class="btn green" href="http://kt-mns.com" target="_blank">KT<br>소상공인<br>홈페이지<br>방문하기</a>
      </div>
    </div>

  </div>

<script>
(function(){
  const $=id=>document.getElementById(id);
  const nkr=n=>Number(n||0).toLocaleString('ko-KR');
  const num=id=>{const el=$(id); return el?Number(el.value||0):0};
  const setNum=(id,v)=>{const el=$(id); if(el) el.value=Number(v||0)};
  const TAX=0.1;

  const PRICE={
    monthly:{ h1:3000, h2:5000, s10_h1:3000, s10_h2:5000, s15:7000, menuSvc:15000, signSvc:15000 },
    onetime:{ h1:108000, h2:170000, s10_h1:108000, s10_h2:170000, s15:237000, install:260000, battery:48500, parts:17000, ap:100000, amp:97000 }
  };
  const isPrepay=()=> (document.querySelector('input[name="paytype"]:checked')?.value==='선불');
  const mPrice=(code)=>{ let v=PRICE.monthly[code]||0; if(isPrepay() && (code==='h1'||code==='h2')) v+=2000; return v; };
  const oPrice=(code)=>{ let v=PRICE.onetime[code]||0; if(isPrepay() && (code==='h1'||code==='h2')) v+=67600; return v; };

  function sectionTotal(section){
    if(section==='menu') return num('q_h1')+num('q_h2');
    if(section==='sign') return num('q_s10_h1')+num('q_s10_h2')+num('q_s15');
    return 0;
  }
  function rows(section){
    const box = (section==='menu'? $('menuMounts') : $('signMounts'));
    return box ? Array.from(box.querySelectorAll('.check-item')) : [];
  }
  function checkedRows(section){ return rows(section).filter(r=> r.querySelector('.mount-check')?.checked); }
  function sumQty(section){ return rows(section).reduce((s,r)=> s + Number(r.querySelector('.mount-qty').value||0), 0); }

  function distribute(section, autoCheck=false){
    const total=sectionTotal(section);
    const allRows = rows(section);
    let list = checkedRows(section);

    if(autoCheck && total>0 && list.length===0 && allRows.length>0){
      const firstCb = allRows[0].querySelector('.mount-check');
      if(firstCb){ firstCb.checked = true; }
      list = checkedRows(section);
    }
    if(list.length===0){
      allRows.forEach(r=> r.querySelector('.mount-qty').value=0);
      return;
    }
    if(list.length===1){
      allRows.forEach(r=>{ if(!r.querySelector('.mount-check').checked) r.querySelector('.mount-qty').value=0; });
      list[0].querySelector('.mount-qty').value=total;
      return;
    }
    const base=Math.floor(total/list.length); let rem=total-base*list.length;
    allRows.forEach(r=>{ if(!r.querySelector('.mount-check').checked) r.querySelector('.mount-qty').value=0; });
    list.forEach(r=> r.querySelector('.mount-qty').value=base);
    for(let i=0;i<list.length && rem>0;i++,rem--){
      const inp=list[i].querySelector('.mount-qty'); inp.value=Number(inp.value)+1;
    }
  }

  function rebalance(section,changed){
    const total=sectionTotal(section);
    const list=checkedRows(section);
    if(list.length===0){ distribute(section, false); return; }
    list.forEach(r=>{ const inp=r.querySelector('.mount-qty'); if(Number(inp.value)<0) inp.value=0; });
    let cur=sumQty(section); if(cur===total) return;

    const others=list.map(r=> r.querySelector('.mount-qty'));
    const i=others.indexOf(changed); if(i>=0) others.splice(i,1);
    if(others.length===0){ changed.value=total; return; }

    if(cur>total){
      let diff=cur-total;
      for(const inp of others){
        const can=Math.min(diff, Number(inp.value));
        inp.value=Number(inp.value)-can; diff-=can; if(diff<=0) break;
      }
    }else{
      let diff=total-cur, k=0;
      while(diff>0){ const inp=others[k%others.length]; inp.value=Number(inp.value)+1; diff--; k++; }
    }
  }

  function syncByTotals(){
    const mTot=sectionTotal('menu'); const sTot=sectionTotal('sign');
    $('badgeMenuSvcCnt').textContent=mTot; $('badgeSignSvcCnt').textContent=sTot;

    setNum('q_install', mTot+sTot); setNum('q_parts', mTot+sTot);

    const all=mTot+sTot; const m=num('q_batt_main'); const p=num('q_batt_portable');
    if(m+p!==all){
      const act=document.activeElement?.id;
      if(act==='q_batt_portable') setNum('q_batt_main',Math.max(0,all-p));
      else setNum('q_batt_portable',Math.max(0,all-m));
    }
  }

  function addLine(tbody, name, unit, qty, discount=false){
    const q=Number(qty||0); if(!q) return 0;
    const u=Number(unit||0); const supply=u*q; const tax=Math.round(supply*TAX); const total=supply+tax;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${name}${discount? ' <span class="muted">(할인)</span>':''}</td><td>${nkr(u)}</td><td>${q}</td><td>${nkr(supply)}</td><td>${nkr(tax)}</td><td>${discount? '0' : nkr(total)}</td>`;
    tbody.appendChild(tr);
    return total;
  }

  function render(){
    syncByTotals();
    const tbody=$('tbodyLines'); tbody.innerHTML='';
    let monthly=0, onetime=0, discount=0;

    const h1=num('q_h1'), h2=num('q_h2');
    const s10h1=num('q_s10_h1'), s10h2=num('q_s10_h2'), s15=num('q_s15');

    monthly+=addLine(tbody,'하이오더 1 (3년)', mPrice('h1'), h1);
    monthly+=addLine(tbody,'하이오더 2 (3년)', mPrice('h2'), h2);
    monthly+=addLine(tbody,'알림판 10인치 (하이오더1, 3년)', mPrice('s10_h1'), s10h1);
    monthly+=addLine(tbody,'알림판 10인치 (하이오더2, 3년)', mPrice('s10_h2'), s10h2);
    monthly+=addLine(tbody,'알림판 15인치 (3년)', mPrice('s15'), s15);
    monthly+=addLine(tbody,'메뉴판 서비스이용료', mPrice('menuSvc'), h1+h2);
    monthly+=addLine(tbody,'알림판 서비스이용료', mPrice('signSvc'), s10h1+s10h2+s15);

    onetime+=addLine(tbody,'하이오더 1 (일시불)', oPrice('h1'), h1);
    onetime+=addLine(tbody,'하이오더 2 (일시불)', oPrice('h2'), h2);
    onetime+=addLine(tbody,'알림판 10인치 (하이오더1, 일시불)', oPrice('s10_h1'), s10h1);
    onetime+=addLine(tbody,'알림판 10인치 (하이오더2, 일시불)', oPrice('s10_h2'), s10h2);
    onetime+=addLine(tbody,'알림판 15인치 (일시불)', oPrice('s15'), s15);

    const inst = addLine(tbody,'설치비용', oPrice('install'), num('q_install'), true);
    const batt = addLine(tbody,'배터리', oPrice('battery'), num('q_batt_main')+num('q_batt_portable'), true);
    const parts= addLine(tbody,'부자재', oPrice('parts'), num('q_parts'), true);
    const ap   = addLine(tbody,'와이파이 AP', oPrice('ap'), num('q_ap'), true);
    const amp  = addLine(tbody,'증폭기', oPrice('amp'), num('q_amp'), true);
    onetime += inst + batt + parts + ap + amp;
    discount += inst + batt + parts + ap + amp;

    $('tdMonthly').textContent=nkr(monthly);
    $('tdOnetime').textContent=nkr(onetime);
    $('tdDiscount').textContent='- '+nkr(discount);
    $('tdGrand').textContent=nkr(Math.max(0, monthly + onetime - discount));
  }

  // === Make Webhook으로 전송 ===
  const MAKE_WEBHOOK_URL = "https://hook.eu2.make.com/12nbyh6gcmb7z1b1f5viuhwnmnmizlxk";

  function gatherMounts(section){
    return rows(section).map(r=>{
      const name = r.querySelector('span')?.textContent?.trim() || '';
      const checked = r.querySelector('.mount-check')?.checked || false;
      const qty = Number(r.querySelector('.mount-qty')?.value || 0);
      return { name, checked, qty };
    });
  }

  function buildPayload(){
    render(); // 최신 합계 보장
    return {
      timestamp: new Date().toISOString(),
      paytype: document.querySelector('input[name="paytype"]:checked')?.value || '후불',
      // 개인정보 필드 제거(요청/문의만 보냄)
      note: $('cust_note').value.trim(),
      qty: {
        menu: { h1: num('q_h1'), h2: num('q_h2') },
        sign: { s10_h1: num('q_s10_h1'), s10_h2: num('q_s10_h2'), s15: num('q_s15') }
      },
      mounts: {
        menu: gatherMounts('menu'),
        sign: gatherMounts('sign')
      },
      fees: {
        monthly: $('tdMonthly').textContent,
        onetime: $('tdOnetime').textContent,
        discount: $('tdDiscount').textContent,
        grand: $('tdGrand').textContent
      }
    };
  }

  async function sendToMake(){
    const btn = $('btnEmail');
    const old = btn.innerHTML;
    btn.disabled = true; btn.innerHTML = '전송 중...';
    try{
      const res = await fetch(MAKE_WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(buildPayload())
      });
      if(!res.ok) throw new Error('Webhook 응답 오류: '+res.status);
      alert('신청이 접수되었습니다. 담당자가 곧 연락드립니다.');
    }catch(err){
      console.error(err);
      alert('전송 실패. 잠시 후 다시 시도해 주세요.');
    }finally{
      btn.disabled = false; btn.innerHTML = old;
    }
  }

  function wire(){
    ['q_h1','q_h2','q_s10_h1','q_s10_h2','q_s15','q_batt_main','q_batt_portable']
      .forEach(id=>{
        const el=$(id);
        if(el) el.addEventListener('input', ()=>{
          distribute('menu', true);
          distribute('sign', true);
          render();
        });
      });

    document.querySelectorAll('input[name="paytype"]').forEach(r=> r.addEventListener('change', render));

    function bindMount(section){
      rows(section).forEach(row=>{
        const cb=row.querySelector('.mount-check');
        const qty=row.querySelector('.mount-qty');
        cb.addEventListener('change', ()=>{ distribute(section, false); render(); });
        qty.addEventListener('input', ()=>{ rebalance(section, qty); render(); });
      });
    }
    bindMount('menu'); bindMount('sign');

    $('btnReset').addEventListener('click', ()=>{
      document.querySelectorAll('input[type=number]').forEach(i=>{ if(!i.readOnly) i.value = 0; });
      document.querySelector('input[name="paytype"][value="후불"]').checked = true;
      ['menu','sign'].forEach(sec=> rows(sec).forEach(r=>{
        r.querySelector('.mount-check').checked=false;
        r.querySelector('.mount-qty').value=0;
      }));
      render();
    });

    $('btnEmail').addEventListener('click', sendToMake);
    render();
  }

  document.addEventListener('DOMContentLoaded', wire);
})();
</script>
</body>
</html>
